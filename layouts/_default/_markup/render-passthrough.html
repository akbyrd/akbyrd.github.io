{{ $block := false -}}
{{ if eq .Type "block" -}}
	{{ $block = true -}}
{{ end -}}

{{ $opts := dict "output" "mathml" "displayMode" $block -}}
{{ $result := transform.ToMath .Inner $opts }}
{{ $result = $result.Value }}

{{- /* Remove unnecessary span */}}
{{- $class := printf `class="math %s"` .Type }}
{{- $result = replaceRE `class="katex"` $class $result }}

{{- $result | safeHTML -}}
{{ .Page.Store.Set "hasMath" true }}
